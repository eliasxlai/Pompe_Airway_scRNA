---
title: "7and14"
author: "Elias Lai"
subtitle: ElMallah Lab, Duke University
output:
  pdf_document: default
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, eval = TRUE, comment = NA, 
                      message = FALSE, warning = FALSE,
                      fig.height = 6, fig.width = 9, fig.align = "center")
```

```{r load-packages, message = FALSE, warning = FALSE}
library(tidyverse)
library(dplyr)
library(conflicted)
library(Seurat)
library(CellChat)
library(patchwork)
library(reticulate)
library(ComplexHeatmap)
library(enrichR)
library(DropletUtils)
library(dplyr)
library(Matrix)
library(cowplot)
library(sctransform)
library(ggplot2)
library(SoupX)
library(here)
library(pheatmap)
library(biomaRt)
library(EnhancedVolcano)
library(slingshot)
library(RColorBrewer)
library(scales)
options(future.globals.maxSize= 8912896000000)
col_p = c("#F3E5C2","#EFB89A","#EF8F50", "#F5731D","#FA4602","#FE5100")
options(stringsAsFactors = FALSE)
conflict_prefer("union", "BiocGenerics")
conflict_prefer("slice", "dplyr")
conflict_prefer("filter", "dplyr")
```

```{r read_in_files, message=FALSE, warning=FALSE}
merge <- readRDS("output/merge.rds")
merge.markers <- readRDS("output/merge.markers.rds")

seven <- readRDS("output/seven.rds")
seven.markers <- readRDS("output/seven.markers.rds")
alveolarfibroblast <- readRDS("output/alveolarfibroblast.rds")
adventitialfibroblast <- readRDS("output/adventitialfibroblast.rds")
alveolarfibroblast.markers <- readRDS("output/alveolarfibroblast.markers.rds")
adventitialfibroblast.markers <- readRDS("output/adventitialfibroblast.markers.rds")

fourteen <- readRDS("output/fourteen.rds")
fourteen.markers <- readRDS("output/fourteen.markers.rds")
endothelial <- readRDS("output/endothelial.rds")
endothelial.markers <- readRDS("output/endothelial.markers.rds")
```

```{r redo_find_markers, message=FALSE, warning=FALSE}
merge1 <- SplitObject(merge, split.by = "condition")
```


```{r redo_find_markers, message=FALSE, warning=FALSE}
seven_volcano.markers <- FindMarkers(merge,ident.2 = "AlveolarFibroblast",ident.1 = "7",min.pct = 0.0,logfc.threshold = 0.01)

fourteen_vs_endothelial.markers <- FindMarkers(merge,ident.2 = c("Endothelial", "Endothelial2"),ident.1 = "14",min.pct = 0.0,logfc.threshold = 0.01)
```

```{r EnhancedVolcano, message=FALSE, warning=FALSE}
EnhancedVolcano(seven_vs_alveolarfibroblast.markers,
                title = "Control vs GAA KD, Endothelial",
                #  selectLab = m$V1,
                lab = rownames(endothelial.markers),
                x = 'avg_log2FC',
                y = 'p_val_adj',
                #ylim = c(0,10),
                #xlim = c(-1,1),
                xlab = bquote(~Log[2]~ 'fold change'),
                pCutoff = 10e-2,
                FCcutoff = 0.35,
                pointSize = 3.0,
                labSize = 4.5,
                labCol = 'black',
                labFace = 'bold',
                boxedLabels = F,
                colAlpha = 4/5,
                legendLabels=c('NS','log2 fold-change','P value',
                         'P value & log2 fold-change'),
                legendPosition = 'left',
                legendLabSize = 10,
                legendIconSize = 4.0,
                drawConnectors = F,widthConnectors = 0.75, arrowheads = TRUE
)+NoLegend()

EnhancedVolcano(fourteen_vs_endothelial.markers,
                title = "Control vs GAA KD, Endothelial",
                #  selectLab = m$V1,
                lab = rownames(endothelial.markers),
                x = 'avg_log2FC',
                y = 'p_val_adj',
                #ylim = c(0,10),
                #xlim = c(-1,1),
                xlab = bquote(~Log[2]~ 'fold change'),
                pCutoff = 10e-2,
                FCcutoff = 0.35,
                pointSize = 3.0,
                labSize = 4.5,
                labCol = 'black',
                labFace = 'bold',
                boxedLabels = F,
                colAlpha = 4/5,
                legendLabels=c('NS','log2 fold-change','P value',
                         'P value & log2 fold-change'),
                legendPosition = 'left',
                legendLabSize = 10,
                legendIconSize = 4.0,
                drawConnectors = F,widthConnectors = 0.75, arrowheads = TRUE
)+NoLegend()
```











